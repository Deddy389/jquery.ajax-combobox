<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>jquery.ajaxComboBox.5.0.js</title>
		<link rel="stylesheet" type="text/css" href="acbox/jquery.ajaxComboBox.css">

		<script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
		<script type="text/javascript" src="acbox/jquery.ajaxComboBox.5.0.js"></script>

		<link rel="stylesheet" type="text/css" href="sample/sample.css">
		<script type="text/javascript" src="sample/sample_ja.js"></script>
	</head>
	<body>
		<h2>jquery.ajaxComboBox.5.0.js</h2>
		<p class="date">2012-04-03</p>
		<ul>
			<li>Server Side : PHP5</li>
			<li>DataBase : MySQL</li>
			<li>DOCTYPE : HTML5</li>
			<li>jQuery : 1.7.2.min</li>
		</ul>

		<!--**************************************************** -->
		<a href="index.html">=> English</a>

		<h4 id="idx_area">目次</h4>
		<ol>
			<li class="big_idx">
				<a href="#sample01">基本的な使い方</a>
				<ol>
					<li><a href="#sample01_01">基本</a></li>
					<li><a href="#sample01_02">候補リスト・隣接ページの表示数を変更</a></li>
					<li><a href="#sample01_03">ページナビをシンプルに</a></li>
					<li><a href="#sample01_04">複数のフィールドから検索</a></li>
					<li><a href="#sample01_05">OR検索へ切り替える</a></li>
				</ol>
			</li>
			<li class="big_idx">
				<a href="#sample02">サブ情報を表示</a>
				<ol>
					<li><a href="#sample02_01">基本</a></li>
					<li><a href="#sample02_02">表の項目名を変更</a></li>
					<li><a href="#sample02_03">サブ情報の表示カラムの設定</a></li>
					<li><a href="#sample02_04">サブ情報の非表示カラムの設定</a></li>
					<li><a href="#sample02_05">サブ情報を他で利用する</a></li>
				</ol>
			</li>
			<li class="big_idx"><a href="#sample03">セレクト専用</a>
				<ol>
					<li><a href="#sample03_01">基本</a></li>
					<li><a href="#sample03_02">送信する値のカラムを変更</a></li>
				</ol>
			</li>
			<li class="big_idx">
				<a href="#sample04">初期値設定</a>
				<ol>
					<li><a href="#sample04_01">基本</a></li>
					<li><a href="#sample04_02">セレクト専用</a></li>
				</ol>
			</li>
			<li class="big_idx">
				<a href="#sample05">データベースではなく、JSON形式のデータを検索する</a>
				<ol>
					<li><a href="#sample05_01">基本</a></li>
				</ol>
			</li>
			<li class="big_idx">
				<a href="#sample06">候補選択と同時に、別のイベントを発火する</a>
				<ol>
					<li><a href="#sample06_01">基本</a></li>
					<li><a href="#sample06_02">フォームタグで囲んでいない場合</a></li>
				</ol>
			</li>
		</ol>
		<input type="text" id="test" placeholder="test">
		<!--**************************************************** -->
		<h4 id="sample01">基本的な使い方</h4>

		<h5 id="sample01_01">基本</h5>
		<p>
			第1引数にAjax送信先のファイル名を、<br />
			第2引数にオプションを設定します。
		</p>
		<label for="ac01_01">都道府県:</label>
		<input type="text" id="ac01_01">
		<input class="check_btn" type="button" value="送信される値をチェック" onclick="displayResult('ac01_01')" />
<code>
  $('#ac01_01').ajaxComboBox(
    'acbox/jquery.ajaxComboBox.php',
    {
      'db_table'    : 'ja_prefecture',
      'order_field' : 'id'
    }
  );

</code>
		<!--------------------------------------------------------->
		<h5 id="sample01_02">候補リスト・隣接ページの表示数を変更</h5>
		<p>
			"per_page"オプションで、候補リストの表示数を、<br />
			"navi_num"オプションで、隣接ページの表示数を変更できます。
		</p>
		<label for="ac01_02">人名:</label>
		<input id="ac01_02" type="text" style="width:420px">
		<input class="check_btn" type="button" value="送信される値をチェック" onclick="displayResult('ac01_02')" />
<code>
  $('#ac01_02').ajaxComboBox(
    'acbox/jquery.ajaxComboBox.php',
    {
      'db_table'    : 'ja_name',
      <span class="green">'per_page'    : 20,</span>
      <span class="green">'navi_num'    : 10,</span>
    }

</code>
		<!--------------------------------------------------------->
		<h5 id="sample01_03">ページナビをシンプルに</h5>
		<p>
			ComBoxの幅をできるだけ狭くしたい場合、"navi_simple"オプションで<br />
			先頭・末尾のページへのリンクを非表示にできます。<br />
			なお、キーボードのショートカットは有効のままです。(Shift + 右・左)
		</p>
		<label for="ac01_03">人名:</label>
		<input id="ac01_03" type="text" style="width:200px">
		<input class="check_btn" type="button" value="送信される値をチェック" onclick="displayResult('ac01_03')" />
<code>
  $('#ac01_03').ajaxComboBox(
    'acbox/jquery.ajaxComboBox.php',
    {
      'db_table'    : 'ja_name',
      'navi_num'    : 1,
      <span class="green">'navi_simple' : true</span>
    }

</code>
		<!--------------------------------------------------------->
		<h5 id="sample01_04">複数のフィールドから検索</h5>
		<p>
			カンマ区切りでフィールド名を指定することで、<br />
			同じテーブルの中の複数のフィールドから検索できます。<br />
			試しに、下のボックスに『23』と入力してみてください。
		</p>
		<label for="ac01_04">都道府県(name, id両方で検索):</label>
		<input id="ac01_04" type="text">
		<input class="check_btn" type="button" value="送信される値をチェック" onclick="displayResult('ac01_04')" />
<code>
  $('#ac01_04').ajaxComboBox(
    'acbox/jquery.ajaxComboBox.php',
    {
      'db_table'    : 'ja_prefecture',
      <span class="green">'search_field': 'name, id'</span>
    }
  );

</code>
		<!--------------------------------------------------------->
		<h5 id="sample01_05">OR検索へ切り替える</h5>
		<p>
			スペース区切りで複数の言葉で検索した場合、<br />
			デフォルトではAND検索となりますが、OR検索にすることもできます。<br />
			試しに、下のボックスに『道 島』と入力してみてください。
		</p>
		<label for="ac01_05">都道府県:</label>
		<input id="ac01_05" type="text">
		<input class="check_btn" type="button" value="送信される値をチェック" onclick="displayResult('ac01_05')" />
<code>
  $('#ac01_05').ajaxComboBox(
    'acbox/jquery.ajaxComboBox.php',
    {
      'db_table'    : 'ja_prefecture',
      <span class="green">'and_or'      : 'OR'</span>
    }
  );

</code>

		<div class="top_navi"><a href="#idx_area"> ▲ 目次へ </a></div>
		<!--**************************************************** -->
		<h4 id="sample02">サブ情報を表示</h4>
		<p>
			同一名の候補がある場合、右側にサブ情報を表示させて<br />
			それぞれを区別することができます。
		</p>
		<h5 id="sample02_01">基本</h5>
		<p>
			"sub_info"オプションを真にするだけです。
		</p>
		<label for="ac02_01">社員名:</label>
		<input id="ac02_01" type="text">
		<input class="check_btn" type="button" value="送信される値をチェック" onclick="displayResult('ac02_01')" />
<code>
  $('#ac02_01').ajaxComboBox(
    'acbox/jquery.ajaxComboBox.php',
    {
      'db_table'    : 'ja_employee',
      <span class="green">'sub_info'    : true</span>
    }
  );

</code>
		<!--------------------------------------------------------->
		<h5 id="sample02_02">表の項目名を変更</h5>
		<p>
			何も設定しないと、サブ情報の表の項目名は、データベースの<br />
			カラム名が表示されてしまいます。<br />
			"sub_as"オプションで、表示名を変更できます。
		</p>
		<label for="ac02_02">社員名:</label>
		<input id="ac02_02" type="text">
		<input class="check_btn" type="button" value="送信される値をチェック" onclick="displayResult('ac02_02')" />
<code>
  $('#ac02_02').ajaxComboBox(
    'acbox/jquery.ajaxComboBox.php',
    {
      'db_table'    : 'ja_employee',
      'sub_info'    : true,
      <span class="green">'sub_as'      : {</span>
        <span class="green">'id'       : '社員番号',</span>
        <span class="green">'post'     : '部署',</span>
        <span class="green">'position' : '役職'</span>
      <span class="green">}</span>
    }
  );

</code>
		<!--------------------------------------------------------->
		<h5 id="sample02_03">サブ情報の表示カラムの設定</h5>
		<p>
			"show_field"オプションで設定します。<br />
			カンマ区切りで、複数のカラム名を指定します。<br />
			オプションでの記述の順番でカラムを取得します。<br />
		</p>
		<label for="ac02_03">社員名:</label>
		<input id="ac02_03" type="text">
		<input class="check_btn" type="button" value="送信される値をチェック" onclick="displayResult('ac02_03')" />
<code>
  $('#ac02_03').ajaxComboBox(
    'acbox/jquery.ajaxComboBox.php',
    {
      'db_table'    : 'ja_employee',
      'sub_info'    : true,
      'sub_as'      : {
        'post'     : '部署',
        'position' : '役職'
      },
      <span class="green">'show_field'  : 'position,post'</span>
    }
  );

</code>
		<!--------------------------------------------------------->
		<h5 id="sample02_04">サブ情報の非表示カラムの設定</h5>
		<p>
			"hide_field"オプションで設定します。<br />
			複数のカラムを取得する場合の記述のルールは<br />
			"show_field"オプションと同じです。<br />
		</p>
		<label for="ac02_04">社員名:</label>
		<input id="ac02_04" type="text">
		<input class="check_btn" type="button" value="送信される値をチェック" onclick="displayResult('ac02_04')" />
<code>
  $('#ac02_04').ajaxComboBox(
    'acbox/jquery.ajaxComboBox.php',
    {
      'db_table'    : 'ja_employee',
      'sub_info'    : true,
      'sub_as'      : {
        'id'       : '社員番号'
      },
      <span class="green">'hide_field'  : 'position,post'</span>
    }
  );

</code>
		<!--------------------------------------------------------->
		<h5 id="sample02_05">サブ情報を他で利用する</h5>
		<p>
			候補を選択した際、<br />
			テキストボックスの『sub_info』という独自の属性に<br />
			JSON形式でサブ情報が格納されるので、他で利用することが可能です。
		</p>
		<label for="ac02_05">社員名:</label>

		<input id="ac02_05" type="text">
		<input class="check_btn" type="button" value="サブ情報をチェック" onclick="func_02_05()" />
<script>
function func_02_05(){
  var result = 'サブ情報\n';
  var json = $('#ac02_05').attr('sub_info');
  var obj = eval( '(' + json + ')' );
  for(var key in obj){
    result += key + ' : ' + obj[key] + '\n';
   } 
  alert(result);
}
</script>
<code>
  var result = 'サブ情報\n';
  var json = $('#ac_02_05')<span class="green">.attr('sub_info')</span>;
  var obj = <span class="green">eval( '(' + json + ')' )</span>;
  for(var key in obj){
    result += key + ' : ' + obj[key] + '\n';
   } 
  alert(result);

</code>

		<div class="top_navi"><a href="#idx_area"> ▲ 目次へ </a></div>
		<!--**************************************************** -->
		<h4 id="sample03">セレクト専用</h4>
		<h5 id="sample03_01">基本</h5>
		<p>
			リストからの選択しか受け付けません。<br />
			リストにない値を入力した場合、また、選択後に<br />
			文字列を削除・追加した場合、入力エリアが赤くなります。
		</p>
		<label for="ac03_01">社員名:</label>
		<input id="ac03_01" name="ac03_01" type="text">
		<input class="check_btn" type="button" value="送信される値をチェック" onclick="displayResult('ac03_01')" />
<code>
  $('#ac03_01').ajaxComboBox(
    'acbox/jquery.ajaxComboBox.php',
    {
      'db_table'    : 'ja_employee',
      'sub_info'    : true,
      <span class="green">'select_only' : true</span>
    }
  );

</code>
		<p>
			なお、このオプションを設定すると、フォームで送信されるのは<br />
			"primary_key"オプションで設定したカラムの値になります。
			この値は、候補リストの&lt;li&gt;要素のid属性にもなります。<br />
		</p>
		<p>
			テキストボックスと同じname属性を持つ隠しフィールド(hidden)を<br />
			生成し、リストから選択した場合のみ、"primary_key"の値を<br />
			hiddenのvalue属性に設定しています。
		</p>
		<code>
		<span class="gray">//テキストボックス</span>
		&lt;input id=&quot;ac03_01&quot; name=&quot;<span class="green">ac03_01_1</span>&quot; type=&quot;text&quot; /&gt;

		<span class="gray">//候補リスト</span>
		...
		&lt;li id=&quot;A014&quot; class=&quot;&quot;&gt;佐藤&lt;/li&gt;
		&lt;li id=&quot;<span class="red">A011</span>&quot; class=&quot;ac_over&quot;&gt;佐藤&lt;/li&gt;
		&lt;li id=&quot;A008&quot; class=&quot;&quot;&gt;佐藤&lt;/li&gt;
		...

		<span class="gray">//隠しフィールド</span>
		&lt;input type=&quot;hidden&quot; name=&quot;<span class="green">ac03_01</span>&quot; value=&quot;<span class="red">A011</span>&quot;/&gt;

		</code>
		<!--------------------------------------------------------->
		<h5 id="sample03_02">送信する値のカラムを変更</h5>
		<p>
			セレクト専用時のデフォルトでは、データベースのテーブルの<br />
			"id"カラムを探し、その値をフォーム送信に用います。<br />
			これを、"primary_key"オプションで変更することができます。
		</p>
		<label for="ac03_02">都道府県:</label>
		<input id="ac03_02" name="ac03_02" type="text">
		<input class="check_btn" type="button" value="送信される値をチェック" onclick="displayResult('ac03_02')" />
<code>
  $('#ac03_02').ajaxComboBox(
    'acbox/jquery.ajaxComboBox.php',
    {
      'db_table'    : 'ja_prefecture',
      'order_field' : 'id',
      'show_field'  : 'id',
      'sub_info'    : true,
      'select_only' : true,
      <span class="green">'primary_key' : 'name'</span>
    }
  );

</code>
		<div class="top_navi"><a href="#idx_area"> ▲ 目次へ </a></div>
		<!--**************************************************** -->
		<h4 id="sample04">初期値設定</h4>
		<p>
			ComboBoxに初期値を設定します。
		</p>
		<h5 id="sample04_01">基本</h5>
		<label for="ac04_01">都道府県:</label>
		<input id="ac04_01" type="text">
		<input class="check_btn" type="button" value="送信される値をチェック" onclick="displayResult('ac04_01')" />

<code>
  $('#ac04_01').ajaxComboBox(
    'acbox/jquery.ajaxComboBox.php',
    {
      'db_table'    : 'ja_prefecture',
      'order_field' : 'id',
      <span class="green">'init_val'    : '東京都'</span>
    }
  );

</code>
		<!--------------------------------------------------------->
		<h5 id="sample04_02">セレクト専用</h5>
		<label for="ac04_02">都道府県:</label>
		<input id="ac04_02" name="ac04_02" type="text">
		<input class="check_btn" type="button" value="送信される値をチェック" onclick="displayResult('ac04_02')" />

<code>
  $('#ac04_02').ajaxComboBox(
    'acbox/jquery.ajaxComboBox.php',
    {
      'db_table'    : 'ja_prefecture',
      'order_field' : 'id',
      <span class="green">'select_only' : true,</span>
      <span class="green">'primary_key' : 'id',</span>
      <span class="green">'init_val'    : 13</span>
    }
  );

</code>
		<div class="top_navi"><a href="#idx_area"> ▲ 目次へ </a></div>
		<!--**************************************************** -->
		<h4 id="sample05">データベースではなく、JSON形式のデータを検索する</h4>
		<p>
			データベースもサーバサイド言語も使わず、JSON形式のデータを検索します。<br>
			JSON形式のデータは、下記のようなオブジェクト配列にする必要があります。
		</p>
<code>
var data = [
	{'id':'A001','name':'田中','post':'営業部','position':'一般'},
	{'id':'A002','name':'佐藤','post':'営業部','position':'一般'},
	{'id':'A003','name':'鈴木','post':'総務部','position':'係長'},
	{'id':'A004','name':'佐藤','post':'総務部','position':'課長'},
	...
];

</code>
		<h5 id="sample05_01">基本</h5>
		<p>
			Ajax通信するサーバサイドのファイル名の代わりに、<br>
			JSON形式のオブジェクト配列を指定します。
		</p>
		<label for="ac05_01">社員名:</label>
		<input id="ac05_01" name="ac05_01" type="text">
		<input class="check_btn" type="button" value="送信される値をチェック" onclick="displayResult('ac05_01')" />

<code>
  $('#ac05_01').ajaxComboBox(
    <span class="green">data</span>,
    {
      'sub_info'    : true,
      'sub_as'      : {
        'id'       : '社員番号',
        'post'     : '部署',
        'position' : '役職'
      },
      'select_only' : true,
      'init_val'    : ['A009'],
      'primary_key' : 'id'
    }
  );

</code>

		<div class="top_navi"><a href="#idx_area"> ▲ 目次へ </a></div>
		<!--**************************************************** -->
		<h4 id="sample06">候補選択と同時に、別のイベントを発火する</h4>
		<h5 id="sample06_01">基本</h5>
		<p>
			『bind()』メソッドを使うことで、候補選択直後に何らかの処理を実行することができます。
		</p>
		<label for="ac06_01">都道府県名:</label>
		<input id="ac06_01" type="text">
<code>
  $('#ac06_01').ajaxComboBox(
    'acbox/jquery.ajaxComboBox.php',
    {
      'db_table'    : 'ja_prefecture',
      'order_field' : 'id',
      <span class="green">'bind_to'     : '<span class="red">foo</span>'</span>
    }
  )
  .bind('<span class="red">foo</span>', function(){
    alert($(this).val() + ' が選択されました');
  });

</code>
		<!--------------------------------------------------------->
		<h5 id="sample06_02">フォームタグで囲んでいない場合</h5>
		<p>
			テキストボックスをフォームタグで囲まず、Enterキーが押された場合の<br />
			イベントハンドラを独自に用意している場合、候補をEnterキーで選ぶと<br />
			イベントが重複して実行されてしまいます。<br />
			それを防ぐため、プラグインの独自イベントが発火する際に、<br />
			Enterキーで候補が選ばれた場合はtrueとなる引数を追加しました。
		</p>
		<label for="ac06_02">都道府県名:</label>
		<input id="ac06_02" type="text">

<code>
  $('#ac06_02').ajaxComboBox(
    'acbox/jquery.ajaxComboBox.php',
    {
      'db_table'    : 'ja_prefecture',
      'order_field' : 'id',
      'bind_to'     : 'foo'
    }
  )
  .bind('foo', function(e, <span class="green">is_enter_key</span>){
    if(<span class="green">!is_enter_key</span>){
      alert($(this).val() + ' が選択されました(マウスで選択)');
    }
  })
  .keydown(function(e){
    if(e.keyCode == 13) alert($(this).val() + ' が選択されました(Enterキーで選択)');
  });

</code>
		<div class="top_navi"><a href="#idx_area"> ▲ 目次へ </a></div>

		<address>
			Author : sutara_lumpur /
			<a href="http://d.hatena.ne.jp/sutara_lumpur/20090124/1232781879">Blog</a> /
			<a href="http://twitter.com/sutara_lumpur">Twitter</a> /
			<img src="sample/mail_image.png" alt="mail address" />
		</address>
	</body>
</html>
